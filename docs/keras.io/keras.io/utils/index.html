<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from keras.io/utils/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 13 Jun 2018 14:16:29 GMT -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Utils - Keras Documentation</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Source+Sans+Pro:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Utils";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-61785484-1', 'keras.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <a href="../index.html"><div class="keras-logo">
        <img src="../img/keras-logo-small-2018.jpg" class="keras-logo-img">
        Keras Documentation
      </div></a>
      <div class="wy-side-nav-search">
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="https://keras.io/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../index.html">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../why-use-keras/index.html">Why use Keras</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Getting started</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../getting-started/sequential-model-guide/index.html">Guide to the Sequential model</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../getting-started/functional-api-guide/index.html">Guide to the Functional API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../getting-started/faq/index.html">FAQ</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Models</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../models/about-keras-models/index.html">About Keras models</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../models/sequential/index.html">Sequential</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../models/model/index.html">Model (functional API)</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Layers</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/about-keras-layers/index.html">About Keras layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/core/index.html">Core Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/convolutional/index.html">Convolutional Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/pooling/index.html">Pooling Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/local/index.html">Locally-connected Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/recurrent/index.html">Recurrent Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/embeddings/index.html">Embedding Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/merge/index.html">Merge Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/advanced-activations/index.html">Advanced Activations Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/normalization/index.html">Normalization Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/noise/index.html">Noise layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/wrappers/index.html">Layer wrappers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/writing-your-own-keras-layers/index.html">Writing your own Keras layers</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Preprocessing</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../preprocessing/sequence/index.html">Sequence Preprocessing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../preprocessing/text/index.html">Text Preprocessing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../preprocessing/image/index.html">Image Preprocessing</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../losses/index.html">Losses</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../metrics/index.html">Metrics</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../optimizers/index.html">Optimizers</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../activations/index.html">Activations</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../callbacks/index.html">Callbacks</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../datasets/index.html">Datasets</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../applications/index.html">Applications</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../backend/index.html">Backend</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../initializers/index.html">Initializers</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../regularizers/index.html">Regularizers</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../constraints/index.html">Constraints</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../visualization/index.html">Visualization</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../scikit-learn-api/index.html">Scikit-learn API</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="index.html">Utils</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#customobjectscope">CustomObjectScope</a></li>
                
            
                <li class="toctree-l3"><a href="#hdf5matrix">HDF5Matrix</a></li>
                
            
                <li class="toctree-l3"><a href="#sequence">Sequence</a></li>
                
            
                <li class="toctree-l3"><a href="#to_categorical">to_categorical</a></li>
                
            
                <li class="toctree-l3"><a href="#normalize">normalize</a></li>
                
            
                <li class="toctree-l3"><a href="#get_file">get_file</a></li>
                
            
                <li class="toctree-l3"><a href="#print_summary">print_summary</a></li>
                
            
                <li class="toctree-l3"><a href="#plot_model">plot_model</a></li>
                
            
                <li class="toctree-l3"><a href="#multi_gpu_model">multi_gpu_model</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../contributing/index.html">Contributing</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Keras Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
    
    <li>Utils</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="http://github.com/keras-team/keras" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><span style="float:right;"><a href="https://github.com/keras-team/keras/blob/master/keras/utils/generic_utils.py#L21">[source]</a></span></p>
<h3 id="customobjectscope">CustomObjectScope</h3>
<pre><code class="python">keras.utils.CustomObjectScope()
</code></pre>

<p>Provides a scope that changes to <code>_GLOBAL_CUSTOM_OBJECTS</code> cannot escape.</p>
<p>Code within a <code>with</code> statement will be able to access custom objects
by name. Changes to global custom objects persist
within the enclosing <code>with</code> statement. At end of the <code>with</code> statement,
global custom objects are reverted to state
at beginning of the <code>with</code> statement.</p>
<p><strong>Example</strong></p>
<p>Consider a custom object <code>MyObject</code> (e.g. a class):</p>
<pre><code class="python">with CustomObjectScope({'MyObject':MyObject}):
    layer = Dense(..., kernel_regularizer='MyObject')
    # save, load, etc. will recognize custom object by name
</code></pre>

<hr />
<p><span style="float:right;"><a href="https://github.com/keras-team/keras/blob/master/keras/utils/io_utils.py#L16">[source]</a></span></p>
<h3 id="hdf5matrix">HDF5Matrix</h3>
<pre><code class="python">keras.utils.HDF5Matrix(datapath, dataset, start=0, end=None, normalizer=None)
</code></pre>

<p>Representation of HDF5 dataset to be used instead of a Numpy array.</p>
<p><strong>Example</strong></p>
<pre><code class="python">x_data = HDF5Matrix('input/file.hdf5', 'data')
model.predict(x_data)
</code></pre>

<p>Providing <code>start</code> and <code>end</code> allows use of a slice of the dataset.</p>
<p>Optionally, a normalizer function (or lambda) can be given. This will
be called on every slice of data retrieved.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>datapath</strong>: string, path to a HDF5 file</li>
<li><strong>dataset</strong>: string, name of the HDF5 dataset in the file specified
    in datapath</li>
<li><strong>start</strong>: int, start of desired slice of the specified dataset</li>
<li><strong>end</strong>: int, end of desired slice of the specified dataset</li>
<li><strong>normalizer</strong>: function to be called on data when retrieved</li>
</ul>
<p><strong>Returns</strong></p>
<p>An array-like HDF5 dataset.</p>
<hr />
<p><span style="float:right;"><a href="https://github.com/keras-team/keras/blob/master/keras/utils/data_utils.py#L302">[source]</a></span></p>
<h3 id="sequence">Sequence</h3>
<pre><code class="python">keras.utils.Sequence()
</code></pre>

<p>Base object for fitting to a sequence of data, such as a dataset.</p>
<p>Every <code>Sequence</code> must implement the <code>__getitem__</code> and the <code>__len__</code> methods.
If you want to modify your dataset between epochs you may implement <code>on_epoch_end</code>.
The method <code>__getitem__</code> should return a complete batch.</p>
<p><strong>Notes</strong></p>
<p><code>Sequence</code> are a safer way to do multiprocessing. This structure guarantees that the network will only train once
 on each sample per epoch which is not the case with generators.</p>
<p><strong>Examples</strong></p>
<pre><code class="python">from skimage.io import imread
from skimage.transform import resize
import numpy as np

# Here, `x_set` is list of path to the images
# and `y_set` are the associated classes.

class CIFAR10Sequence(Sequence):

    def __init__(self, x_set, y_set, batch_size):
        self.x, self.y = x_set, y_set
        self.batch_size = batch_size

    def __len__(self):
        return int(np.ceil(len(self.x) / float(self.batch_size)))

    def __getitem__(self, idx):
        batch_x = self.x[idx * self.batch_size:(idx + 1) * self.batch_size]
        batch_y = self.y[idx * self.batch_size:(idx + 1) * self.batch_size]

        return np.array([
            resize(imread(file_name), (200, 200))
               for file_name in batch_x]), np.array(batch_y)
</code></pre>

<hr />
<h3 id="to_categorical">to_categorical</h3>
<pre><code class="python">keras.utils.to_categorical(y, num_classes=None)
</code></pre>

<p>Converts a class vector (integers) to binary class matrix.</p>
<p>E.g. for use with categorical_crossentropy.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>y</strong>: class vector to be converted into a matrix
    (integers from 0 to num_classes).</li>
<li><strong>num_classes</strong>: total number of classes.</li>
</ul>
<p><strong>Returns</strong></p>
<p>A binary matrix representation of the input. The classes axis
is placed last.</p>
<hr />
<h3 id="normalize">normalize</h3>
<pre><code class="python">keras.utils.normalize(x, axis=-1, order=2)
</code></pre>

<p>Normalizes a Numpy array.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>x</strong>: Numpy array to normalize.</li>
<li><strong>axis</strong>: axis along which to normalize.</li>
<li><strong>order</strong>: Normalization order (e.g. 2 for L2 norm).</li>
</ul>
<p><strong>Returns</strong></p>
<p>A normalized copy of the array.</p>
<hr />
<h3 id="get_file">get_file</h3>
<pre><code class="python">keras.utils.get_file(fname, origin, untar=False, md5_hash=None, file_hash=None, cache_subdir='datasets', hash_algorithm='auto', extract=False, archive_format='auto', cache_dir=None)
</code></pre>

<p>Downloads a file from a URL if it not already in the cache.</p>
<p>By default the file at the url <code>origin</code> is downloaded to the
cache_dir <code>~/.keras</code>, placed in the cache_subdir <code>datasets</code>,
and given the filename <code>fname</code>. The final location of a file
<code>example.txt</code> would therefore be <code>~/.keras/datasets/example.txt</code>.</p>
<p>Files in tar, tar.gz, tar.bz, and zip formats can also be extracted.
Passing a hash will verify the file after download. The command line
programs <code>shasum</code> and <code>sha256sum</code> can compute the hash.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>fname</strong>: Name of the file. If an absolute path <code>/path/to/file.txt</code> is
    specified the file will be saved at that location.</li>
<li><strong>origin</strong>: Original URL of the file.</li>
<li><strong>untar</strong>: Deprecated in favor of 'extract'.
    boolean, whether the file should be decompressed</li>
<li><strong>md5_hash</strong>: Deprecated in favor of 'file_hash'.
    md5 hash of the file for verification</li>
<li><strong>file_hash</strong>: The expected hash string of the file after download.
    The sha256 and md5 hash algorithms are both supported.</li>
<li><strong>cache_subdir</strong>: Subdirectory under the Keras cache dir where the file is
    saved. If an absolute path <code>/path/to/folder</code> is
    specified the file will be saved at that location.</li>
<li><strong>hash_algorithm</strong>: Select the hash algorithm to verify the file.
    options are 'md5', 'sha256', and 'auto'.
    The default 'auto' detects the hash algorithm in use.</li>
<li><strong>extract</strong>: True tries extracting the file as an Archive, like tar or zip.</li>
<li><strong>archive_format</strong>: Archive format to try for extracting the file.
    Options are 'auto', 'tar', 'zip', and None.
    'tar' includes tar, tar.gz, and tar.bz files.
    The default 'auto' is ['tar', 'zip'].
    None or an empty list will return no matches found.</li>
<li><strong>cache_dir</strong>: Location to store cached files, when None it
    defaults to the <a href="../faq/index.html#where-is-the-keras-configuration-filed-stored">Keras Directory</a>.</li>
</ul>
<p><strong>Returns</strong></p>
<p>Path to the downloaded file</p>
<hr />
<h3 id="print_summary">print_summary</h3>
<pre><code class="python">keras.utils.print_summary(model, line_length=None, positions=None, print_fn=None)
</code></pre>

<p>Prints a summary of a model.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>model</strong>: Keras model instance.</li>
<li><strong>line_length</strong>: Total length of printed lines
    (e.g. set this to adapt the display to different
    terminal window sizes).</li>
<li><strong>positions</strong>: Relative or absolute positions of log elements in each line.
    If not provided, defaults to <code>[.33, .55, .67, 1.]</code>.</li>
<li><strong>print_fn</strong>: Print function to use.
    It will be called on each line of the summary.
    You can set it to a custom function
    in order to capture the string summary.
    It defaults to <code>print</code> (prints to stdout).</li>
</ul>
<hr />
<h3 id="plot_model">plot_model</h3>
<pre><code class="python">keras.utils.plot_model(model, to_file='model.png', show_shapes=False, show_layer_names=True, rankdir='TB')
</code></pre>

<p>Converts a Keras model to dot format and save to a file.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>model</strong>: A Keras model instance</li>
<li><strong>to_file</strong>: File name of the plot image.</li>
<li><strong>show_shapes</strong>: whether to display shape information.</li>
<li><strong>show_layer_names</strong>: whether to display layer names.</li>
<li><strong>rankdir</strong>: <code>rankdir</code> argument passed to PyDot,
    a string specifying the format of the plot:
    'TB' creates a vertical plot;
    'LR' creates a horizontal plot.</li>
</ul>
<hr />
<h3 id="multi_gpu_model">multi_gpu_model</h3>
<pre><code class="python">keras.utils.multi_gpu_model(model, gpus=None, cpu_merge=True, cpu_relocation=False)
</code></pre>

<p>Replicates a model on different GPUs.</p>
<p>Specifically, this function implements single-machine
multi-GPU data parallelism. It works in the following way:</p>
<ul>
<li>Divide the model's input(s) into multiple sub-batches.</li>
<li>Apply a model copy on each sub-batch. Every model copy
is executed on a dedicated GPU.</li>
<li>Concatenate the results (on CPU) into one big batch.</li>
</ul>
<p>E.g. if your <code>batch_size</code> is 64 and you use <code>gpus=2</code>,
then we will divide the input into 2 sub-batches of 32 samples,
process each sub-batch on one GPU, then return the full
batch of 64 processed samples.</p>
<p>This induces quasi-linear speedup on up to 8 GPUs.</p>
<p>This function is only available with the TensorFlow backend
for the time being.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>model</strong>: A Keras model instance. To avoid OOM errors,
    this model could have been built on CPU, for instance
    (see usage example below).</li>
<li><strong>gpus</strong>: Integer &gt;= 2 or list of integers, number of GPUs or
    list of GPU IDs on which to create model replicas.</li>
<li><strong>cpu_merge</strong>: A boolean value to identify whether to force
    merging model weights under the scope of the CPU or not.</li>
<li><strong>cpu_relocation</strong>: A boolean value to identify whether to
    create the model's weights under the scope of the CPU.
    If the model is not defined under any preceding device
    scope, you can still rescue it by activating this option.</li>
</ul>
<p><strong>Returns</strong></p>
<p>A Keras <code>Model</code> instance which can be used just like the initial
<code>model</code> argument, but which distributes its workload on multiple GPUs.</p>
<p><strong>Example 1 - Training models with weights merge on CPU</strong></p>
<p>$Example_2_-_Training_models_with_weights_merge_on_CPU_using_cpu_relocation$0</p>
<p><strong>Example 2 - Training models with weights merge on CPU using cpu_relocation</strong></p>
<p>$Example_2_-_Training_models_with_weights_merge_on_CPU_using_cpu_relocation$1</p>
<p><strong>Example 3 - Training models with weights merge on GPU (recommended for NV-link)</strong></p>
<p>$Example_2_-_Training_models_with_weights_merge_on_CPU_using_cpu_relocation$2</p>
<p><strong>On model saving</strong></p>
<p>To save the multi-gpu model, use <code>.save(fname)</code> or <code>.save_weights(fname)</code>
with the template model (the argument you passed to <code>multi_gpu_model</code>),
rather than the model returned by <code>multi_gpu_model</code>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../contributing/index.html" class="btn btn-neutral float-right" title="Contributing"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../scikit-learn-api/index.html" class="btn btn-neutral" title="Scikit-learn API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../scikit-learn-api/index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../contributing/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>

<!-- Mirrored from keras.io/utils/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 13 Jun 2018 14:16:29 GMT -->
</html>
